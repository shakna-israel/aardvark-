#!/bin/sh

set -e

# Error Codes
NOGCC=10
NOBJCOPY=20
NODUDE=30
NOREADLINK=40

# Find avr-gcc.
if [ -f '/bin/avr-gcc' ]; then
  ACC='/bin/avr-gcc'
fi

if [ -f '/usr/bin/avr-gcc' ]; then
  ACC='/usr/bin/avr-gcc'
fi

if [ -f '/usr/local/bin/avr-gcc' ]; then
  ACC='/usr/local/bin/avr-gcc'
fi

if [ -f "$AVR_TOOLS_DIR/bin/avr-gcc" ]; then
  ACC="$AVR_TOOLS_DIR/bin/avr-gcc"
fi

if [ -z "$ACC" ]; then
  echo 'Could not find avr-gcc. Is it installed?' 1>&2
  exit $NOGCC
fi

# Find avr-objcopy
if [ -f '/bin/avr-objcopy' ]; then
  AOC='/bin/avr-objcopy'
fi

if [ -f '/usr/bin/avr-objcopy' ]; then
  AOC='/usr/bin/avr-objcopy'
fi

if [ -f '/usr/local/bin/avr-objcopy' ]; then
  AOC='/usr/local/bin/avr-objcopy'
fi

if [ -f "$AVR_TOOLS_DIR/bin/avr-objcopy" ]; then
  AOC="$AVR_TOOLS_DIR/bin/avr-objcopy"
fi

if [ -z "$AOC" ]; then
  echo 'Could not find avr-objcopy. Is it installed?' 1>&2
  exit $NOBJCOPY
fi

#Find avrdude
if [ -f '/bin/avrdude' ]; then
  AD='/bin/avrdude'
fi

if [ -f '/usr/bin/avrdude' ]; then
  AD='/usr/bin/avrdude'
fi

if [ -f '/usr/local/bin/avrdude' ]; then
  AD='/usr/local/bin/avrdude'
fi

if [ -f "$AVR_TOOLS_DIR/bin/avrdude" ]; then
  AOC="$AVR_TOOLS_DIR/bin/avrdude"
fi

if [ -z "$AD" ]; then
  echo 'Could not find avrdude. Is it installed?' 1>&2
  exit $NODUDE
fi

#Find readlink or greadlink
if [ -f '/usr/local/bin/greadlink' ]; then
  RL="true"
fi

if [ -f '/bin/readlink' ]; then
  RL="true"
fi

if [ -f '/usr/bin/readlink' ]; then
  RL="true"
fi

if [ -f '/usr/local/bin/readlink' ]; then
  RL="true"
fi

if [ -z "$RL" ]; then
  echo 'Could not find readlink. Is it installed?' 1>&2
  echo 'Note: macOS users, you may need the GNU coreutils, try the homebrew or macports package managers.' 1>&2
  exit $NOREADLINK
fi

echo "$ACC|$AOC|$AD"
